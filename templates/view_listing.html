{% extends 'root/base.html' %}
{% load humanize %}
{% load static %}
{% load extra %}

    {% load bootstrap %}

{% block header_block %}

<style type="text/css">
#map_canvas{
  min-height: 200px;
  min-width: 200px;
}
.googlebutton{
            background-color: #DC4B39;
            width: 286px;
            height: 39px;
            border:none;
            margin-bottom: 20px;
            text-align: center;
            margin-top: 10px;
        }
        .socialtext{
            color: white;
            margin-top:3%;
            position: relative;
            right:10px;
        }
        .fbbutton{
            background-color: #3B5998;
            width: 286px;
            height: 39px;
            border:none;
        }
        .scicon{
            width:30px;
            float: left;
            position: relative;
            top:-5px;

        }
       
        .modaldialog{
          height: 435px;
          width:840px;
        }
        .logcol3{
          padding-top: 0px;
        }
         .regcol {
    border-left: 1px solid #d1d1d1;
}




</style>
<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=false&v=3.5">
</script>
    <script type="text/javascript" src="{% static 'js/show_more.js' %}">

    </script>

    <script type="text/javascript">

    $(document).ready(function(){
      var map;
      var latLn;




              $('#contactbtn').click(function(e){
                e.preventDefault();
                var listing = '{{listing.name}}';

                $.ajax({
                  data:{listing},
                  
                  type: "GET", // GET or POST
                  url: '/ajax/' , // the file to call
            success: function(response) { 
              var message = response.message;
              if (message.phone == 1){
                  $('#c_name').text("Contact Name : " + message.contact_name);
                  $('#c_num').text("Contact Number: " + message.contact_number);
                  $('#lat').text(message.latitude);
                  $('#long').text(message.longitude);
                  $('#address').text("City Address : " + message.address_city);
                  $('#contactModal').modal('show');
                }
              else{
                  $('#phoneModal').modal('show');
                }

                
            },
            
        });
      
        return false;
    });




               
              $('#phoneform').submit(function(e) {
          e.preventDefault()
            


           // catch the form's submit event
        $.ajax({ 
            data: $(this).serialize(), // get the form data
            type: $(this).attr('method'), // GET or POST
            url: $(this).attr('action'), // the file to call
            success: function(response) { // on success..
                if (response.message.status == 1){
                  $('#phoneModal').modal('hide');
                  $('#contactbtn').trigger('click');

                };
                if (response.message.status==2){
                  $("#error").text("Your number must be between 10 and 12 digits.");


                };
                if (response.message.status==3){
                  $("#error").text("Please enter a valid number.");


                };
            },
            error: function(e, x, r) { // on error..
                $('#error_div').html(e); // update the DIV
            }
        });
    
        return false;
    });

{% if listing.latitude %}
function initialize() {
    var position = new google.maps.LatLng({{listing.latitude}}, {{listing.longitude}});
    var myOptions = {
      zoom: 10,
      center: position,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
     map = new google.maps.Map(
        document.getElementById("map_canvas"),
        myOptions);
 
    var marker = new google.maps.Marker({
        position: position,
        map: map
        
    });
        latLn = marker.getPosition();
   
  };
$(window).load(initialize())
$('#contactModal').on('shown.bs.modal', function (e) {
  google.maps.event.trigger(map, 'resize');
      map.setCenter(latLn);  


})


  {% endif %}


    









    });

    $(function(){
        $('#price-popover').popover({ trigger: "hover" });

        $(".description-holder p").shorten({
            "showChars" : 500,
    "moreText"  : "See More",
    "lessText"  : "Less"});

        $(".pricing-text-holder").shorten({
            "showChars" : 200,
    "moreText"  : "See More",
    "lessText"  : "Less"});


    });


    </script>

{% endblock %}

{% block body_block %}
<div id="loginmodal" class="modal fade" role="dialog">
  <div class="modal-dialog modaldialog">

    <!-- Modal content-->
    <div class="modal-content">
      
      <div class="modal-body bodymodal">
        <div class="row">
            <div class="alert alert-danger">
  You must login to see contact details!
</div>
         <div class="col-md-6 logcol2 logcol3">




    <form method="post" id="loginform" action ="/user/login?next={{request.path}}">

    {% csrf_token %}

    {{ form_login |bootstrap}}
<a><input class = "btn btn-default buttonsubmit" type="submit" value="Login" name="login"></a>

        <a href="#" id="forgot">Forgot Password?</a>
        <button class="googlebutton gfbtn"><div>
            <img src="{% static 'google.png' %}" class="scicon">
            <p class="socialtext">Continue With Google</p>

        </div></button>
        <button class="fbbutton gfbtn"><div>
            <img src="{% static 'facebook.png' %}" class="scicon">
            <p class="socialtext">Continue With Facebook</p>

        </div></button>




</form>



</div>
<div class="col-md-6 regcol">


            <form method="post" id="registerform" action="/user/register?next={{request.path}}" >

    {% csrf_token %}

    {{ form_register | bootstrap }}

    <input type="submit" class="btn btn-default buttonsubmit" value="Sign Up">

</form>


            </div>
</div>

      </div>

    </div>

  </div>
</div>
        <div id="contactModal" class="modal fade" role="dialog">
  <div class="modal-dialog ">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body bodymodal">
        <h3 id="c_name"></h3>
        <h3 id="c_num"></h3>

        <h3 id="address"></h3>
        {% if listing.latitude %}

        <div id="map_canvas">

        </div>
        {% endif %}

                
      </div>
    </div>

  </div>
</div>
<div id="ratingModal" class="modal fade" role="dialog">
  <div class="modal-dialog ">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body bodymodal">
<form id="rateform" method="post" name="rate"> 
          {% csrf_token %}
          <div class="row">
            <div class="col-md-6">
        {{ rating_form.param_1|bootstrap}}
        {{ rating_form.param_2 | bootstrap}}
        {{ rating_form.param_3 | bootstrap}}
        {{ rating_form.param_4 | bootstrap}}
        {{ rating_form.param_5 | bootstrap}}


            </div>
            <div class="col-md-6">
        {{ rating_form.param_6 | bootstrap}}
        {{ rating_form.param_7 | bootstrap}}
        {{ rating_form.param_8 | bootstrap}}
        {{ rating_form.param_9 | bootstrap}}
        {{ rating_form.param_10 | bootstrap}}

            </div>
          </div>
                      {{ rating_form.is_active|bootstrap}}


   
<a><input class = "btn btn-default buttonsubmit" type="submit" value="Submit" name="rate" id="ratesubmit"></a>

        </form>      </div>
    </div>

  </div>
</div>
<div id="phoneModal" class="modal fade" role="dialog">
  <div class="modal-dialog ">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body bodymodal">
        <div class="alert alert-danger">
  You must enter your phone number to see contact details!
</div>
        <form id="phoneform" method="post" action="/ajax/"> 
          {% csrf_token %}
        {{ phoneform | bootstrap_inline}}

        <h3 id="error"></h3>
<a><input class = "btn btn-default buttonsubmit" type="submit" value="Submit" name="phone" id="phonesubmit"></a>

        </form>
        

                
      </div>
    </div>

  </div>
</div>

    <div class="listing-container">

    <div class="row">

    <div class="col-md-3">


    <div class="name-sidebar">
        <div class="talent-holder">
       <h2> {{ listing.talents }} </h2>
            <hr class="caption-separator">
            </div>
        <div class="tags-holder">
            {% for tag in listing.tags.all %} <p class="tag">{{ tag }}</p> {% endfor %}
        </div>
        <br/>
        <div class="pricing-holder">
            <h4>Pricing
                <div id="price-popover" data-content="{{ listing.comments }}" class="pull-right" rel="popover" data-placement="bottom">Rs {{ listing.fees|intcomma }} <span class="glyphicon glyphicon-question-sign price-info-icon"></span></div>  </h4>
            <p class="pricing-text-holder"> {{ listing.talents.fee_text }}</p>
        </div>

        <div class="alert alert-warning super-alert">

        {% if listing.tech_details_file %}
        <div class="extra-holder">
          <i class="glyphicon glyphicon-cloud-download"></i> <a href="{{ listing.tech_details_file.url }}">Brochure/Additional Information</a>
        </div>
        {% endif %}
        <div class="outstation-holder">
           <p> {% if listing.outstation == 1 %}
            <i class="glyphicon glyphicon-ok"></i> Service provided in other cities
            {% else %}
            <i class="glyphicon glyphicon-remove"></i> No service in other cities
            {% endif %}
        </p>
        </div>
        </div>
        <div class="contact-details-holder">
            {% if user.is_authenticated %}
            <button class="btn stylebx" id="contactbtn">Contact Details</button>
            {% else %}
            <button class="btn stylebx" data-toggle="modal" data-target="#loginmodal">Contact Details</button>
            {% endif %}
        </div>
        <br>
        {% if user.is_authenticated %}

        {% get_user_type request.user as type %}
        {% if type == 1 %}
        <button class="btn stylebx" data-toggle="modal" data-target="#ratingModal">Rate This Artist</button>
        {% endif %}
        {% endif %}
      




        {% if similar %}
        <div class="similar-listings-holder">
            <h4 class="text-center">Related Listings</h4>
            <hr class="listing-separator">
                {% for sim in similar %}
                    <a class='similar-link' href="{% url 'view_listing' sim.id %}">
                <div class="similar-listing">
                    <div class="row">
                        <div class="col-md-4">
                            <img src="{{ sim.profile_pic.url }}" class="similar-listings-image">
                            </div>
                        <div class="col-md-7">
                            <h5 class="pull-top">{{ sim.name }}</h5>
                            <p>{{ sim.talents }}</p>
                            <h5> &#8377 {{ sim.fees|intcomma }}</h5>
                            </div>
                    </div>
                    </a>
                </div>
                {% endfor %}
        </div>
        {% endif %}

    </div>


  </div>

    <div class="col-md-9">

        <div class="data-siderbar">

            <div class="row">
                <div class="col-md-12">

                    <div class="name-holder">
               <h2>{{ listing.name }}, {{ listing.city }} <span class="rating pull-right rating-box">

                   {% get_rating listing %}

               </span> </h2>
            </div>

                    <hr class="caption-separator">
                    <div class="description-holder">
                <p>{{ listing.bio }}</p>
            </div>

                </div>
            </div>

            <div class="media-holder">
                <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#photos" aria-controls="photos" role="tab" data-toggle="tab">Photos</a></li>
    <li role="presentation"><a href="#videos" aria-controls="videos" role="tab" data-toggle="tab">Videos</a></li>
    <li role="presentation"><a href="{% url 'view_media' listing.id %}#sounds">Sounds</a></li>
  </ul>

                <div class="tab-content media-tabs">
    <div role="tabpanel" class="tab-pane active" id="photos">
    <div class="row">
    {% if images %}
        {% for image in images %}
            <div class="photo-grid-listing pull-left">
      <a href="{% url 'view_media' listing.id %}" class="img-content-listing {% if forloop.last %}{% if image_count > 0 %} trans {% endif %}{% endif %}">
          <img src="{{ image.url }}" alt="{{ image.title }}" />
          {% if forloop.last %}
              {% if image_count > 0 %}
              <h4 class="overlay_img_listing">{{ image_count }}+ more pictures</h4>
                  {% endif %}
          {% endif %}
      </a>
        </div>
        {% endfor %}
    {% else %}
    <h4 class="text-center">The listing doesn't have any uploaded photos</h4>
    {% endif %}
    </div>
    </div>

    <div role="tabpanel" class="tab-pane" id="videos">
            <div class="row">
            {% if videos %}
{% for video in videos %}
    <div class="col-md-3 photo-grid-listing pull-left">
      <a href="{% url 'view_media' listing.id %}#videos" class="img-content-listing {% if forloop.last %}{% if video_count > 0 %} trans {% endif %}{% endif %}">
          <img src="http://img.youtube.com/vi/{{ video.vid }}/hqdefault.jpg" />
          {% if forloop.last %}
              {% if video_count > 0 %}
              <h4 class="overlay_img_listing">{{ video_count }}+ more videos</h4>
                  {% endif %}
          {% endif %}
      </a>
    </div>
{% endfor %}
            {% else %}
                <h4 class="text-center">The user hasn't uploaded any videos</h4>
            {% endif %}
            </div>
    </div>

    <div role="tabpanel" class="tab-pane" id="sounds">
        {% if sounds %}
            {% else %}
            <h4 class="text-center">The user hasn't uploaded any sounds</h4>
        {% endif %}
    </div>
  </div>

            </div>

        {% if projects %}

        <div class="project-holder">

            <h3>Past Work</h3>
            <hr class="caption-separator">
        <div class="row">
            {% for project in projects %}
                <div class="col-md-4">
                <div class="project-box">
                <h4>{{ project.title }}</h4>
                <p>{{ project.description }}</p>
                <p><i class="glyphicon glyphicon-user"></i> {{ project.referral_name }}</p>
                <p><i class="glyphicon glyphicon-phone"></i> {{ project.referral_contact }}, {{ project.referral_contact_2 }} </p>
                <p><i class="glyphicon glyphicon-envelope"></i> {{ project.referral_email }}</p>
                </div>
                </div>

                {% endfor %}
        </div>
                </div>

        {% endif %}


        </div>


        </div>

    </div>


    </div>

    </div>

{% endblock %}