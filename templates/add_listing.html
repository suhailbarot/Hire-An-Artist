{% extends 'root/base.html' %}
{% load static %}
{% load bootstrap_dynamic_formsets %}
    {% load bootstrap %}

    {% block page_title %}Add A Listing{% endblock %}

    {% block header_block %}

           <script src="{% static 'jcrop/js/jquery.min.js' %}"></script>
<script src="{% static 'jcrop/js/jquery.Jcrop.min.js' %}"></script>
<link rel="stylesheet" href="{% static 'jcrop/css/jquery.Jcrop.css' %}" type="text/css" />
<script src="{%  static 'js/jquery-ui.min.js' %}" type="text/javascript"></script>

<script type="text/javascript">


$(document).ready(function(){/* activate sidebar */

/* smooth scrolling sections */
$('a[href*=#]:not([href=#])').click(function() {
    if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
      var target = $(this.hash);
      target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
      if (target.length) {
        $('html,body').animate({
          scrollTop: target.offset().top - 50
        }, 1000);
        return false;
      }
    }
});
});

$(document).ready(function(){

    // Dropdown change stuff
    $(".tagged").hide();

    $('.talent-'+$('select[name=talents]').val()).show();

    $('select[name=talents]').change(function(){
        $(".tagged").hide();
        $('.talent-'+$(this).val()).show();
    });


    // end dropdown change stuff


function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#blah').attr('src', e.target.result);
                $('.crop').Jcrop({
                  onSelect: updateCoords,
                        bgOpacity:   .4,
                        setSelect:   [ 100, 100, 50, 50 ],
                        aspectRatio: 10/16
                });
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#id_profile_pic").change(function(){
        readURL(this);
    });
    $('#btnCrop').click(function () {
        var x1 = $('#id_x').val();
        var y1 = $('#id_y').val();
        var width = $('#id_x2').val();
        var height = $('#id_y2').val();
        var canvas = $("#canvas")[0];
        var context = canvas.getContext('2d');
        var img = new Image();
        img.onload = function () {
            canvas.height = height;
            canvas.width = width;
            context.drawImage(img, x1, y1, width, height, 0, 0, width, height);
            $('#imgCropped').val(canvas.toDataURL());
        };
        img.src = $('#blah').attr("src");
    });

  function updateCoords(c)
  {
    var img2 = new Image();
        img2.src = $('#blah').attr("src");
        var realwidth = img2.width;
        var realheight = img2.height;
        var imgheight = $('#blah').height();
        var imgwidth = $("#blah").width();
        var fx = realwidth/imgwidth;
        var fy = realheight/imgheight;
    $('#id_x').val(parseInt(c.x*fx));
    $('#id_y').val(parseInt(c.y*fy));
    $('#id_x2').val(parseInt(c.w*fx));
    $('#id_y2').val(parseInt(c.h*fy));
    $('#btnCrop').click();
  };
});

</script>

    {% endblock %}

    {% block body_block %}

        <div class="container form-wizard">
      <div class="add-listing-message">
              <h3>Add your listing</h3>
                <p>Your first step towards redemption</p>
            <hr class="message-separator">
        </div>

         <div class="col-md-3">
            <div id="left-bar">
                  <div class="tips-panel" data-spy="affix" data-offset-top="10px" id="sidemenu">
                      <div class="timeline-centered">
        <article class="timeline-entry">
            <div class="timeline-entry-inner">
                <div class="timeline-icon">
                    <i class="entypo-feather glyphicon glyphicon-ok tick-box"></i>
                </div>
                <div class="timeline-label">
                    <a href="#basi">Basic Information</a>
                </div>
            </div>
        </article>
        <article class="timeline-entry">
            <div class="timeline-entry-inner">
                <div class="timeline-icon">
                    <i class="entypo-suitcase"></i>
                </div>
                <div class="timeline-label">
                    <a href="#pricing_det"> Pricing Details </a>
                </div>
            </div>
        </article>
        <article class="timeline-entry">
            <div class="timeline-entry-inner">
                <div class="timeline-icon">
                    <i class="entypo-location"></i>
                </div>
                <div class="timeline-label">
                    <a href="#contact_det">Contact Details</a>
                </div>
            </div>
        </article>
        <article class="timeline-entry">
            <div class="timeline-entry-inner">
                <div class="timeline-icon">
                    <i class="entypo-location"></i>
                </div>
                <div class="timeline-label">
                    <a href="#past_project">Past Projects</a>
                </div>
            </div>
        </article>
{#        <article class="timeline-entry begin">#}
{#            <div class="timeline-entry-inner">#}
{#                <div class="timeline-icon" style="-webkit-transform: rotate(-90deg); -moz-transform: rotate(-90deg);">#}
{#                    <i class="entypo-flight"></i> +#}
{#                </div>#}
{#            </div>#}
{#        </article>#}
    </div>

{#        <ul class="nav nav-pills nav-stacked" id="sidebar" data-spy="affix">#}
{#          <li><a href="#sec0">Section 0</a></li>#}
{#          <li><a href="#sec1">Section 1</a></li>#}
{#          <li><a href="#sec2">Section 2</a></li>#}
{#          <li><a href="#sec3">Section 3</a></li>#}
{#          <li><a href="#sec4">Section 4</a></li>#}
{#        </ul>#}
                  </div>
                </div>
            </div>

        <div class="col-md-9">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
            <div class="section-container" id="basi">
                <div class="section-header">
                    <h1>Basic Information</h1>
                </div>
                <hr class="section-separator">
                <div class="row">
                    <div class="col-md-12">
                        {{ form.name | bootstrap }}
                        </div>
                    <div class="col-md-12">
                        {{ form.talents | bootstrap }}
                        </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        {{ form.functions | bootstrap }}
                        </div>
                    <div class="col-md-12">
                        <h4>{{ form.tags.name }} : </h4>
            <ul>
                {% for choice in form.tags.field.choices %}
                    <li class="tagged talent-{{ choice.2.talent.pk }}" talent_for="{{ choice.2.talent.pk }}">
                        <input type="checkbox"
                               name="{{ form.tags.name }}"
                               value="{{ choice.0 }}"
                                {% if choice.0|safe in form.tags.value or choice.0 in form.tags.value %} checked="checked" {% endif %}>
                        <strong>{{ choice.2 }}</strong>
                    </li>
                {% endfor %}
            </ul>
            {% if form.tags.errors %}
                <span class="help-block">{{ form.tags.errors }}</span>
            {% endif %}
                        </div>
                </div>

                <div class="row">

                <div class="col-md-12">

                    {{ form.bio | bootstrap }}

                    </div>

                    <div class="col-md-12">

                        {{ form.outstation | bootstrap }}

                        </div>

                    <div class="col-md-12">

                        {{ form.city | bootstrap }}

                    </div>

                    <div class="col-md-12">

                        {{ form.group_key | bootstrap }}

                        </div>

                    <div class="col-md-12">

                        {{ form.profile_pic | bootstrap }}
                </div>

                    <div class="col-md-12">

                        <h3>Crop it</h3>

                        <table>
    <tr>
        <td>
<img id="blah" class="crop" />
        </td>
        <td>
            <canvas id="canvas" height="5" width="5"></canvas>
        </td>
    </tr>
</table>
<br>

<input type="button" id="btnCrop" type="hidden" style="display: none"/>
<input type="hidden" name="imgCropped" id="imgCropped" />


                        </div>



            </div>

{#            <div class="panel-body">#}
{#            <div class="panel panel-default" id="sec0">#}
{#              <div class="panel-heading"><h3>Hello.</h3></div>#}
{#              <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.#}
{#                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis#}
{#                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.#}
{#                Aliquam in felis sit amet augue.#}
{#              </div>#}
{#            </div>#}
{##}
{#            <div class="panel panel-default" id="sec1">#}
{#              <div class="panel-heading"><h3 >Hello.</h3></div>#}
{#              <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.#}
{#                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis#}
{#                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.#}
{#                Aliquam in felis sit amet augue.#}
{#              </div>#}
{#            </div>#}
{##}
{#            <div class="panel panel-default" id="sec2">#}
{#              <div class="panel-heading"><h3>Hello.</h3></div>#}
{#              <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.#}
{#                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis#}
{#                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.#}
{#                Aliquam in felis sit amet augue.#}
{#              </div>#}
{#            </div>#}
{##}
{#            <div class="panel panel-default" id="sec3">#}
{#              <div class="panel-heading"><h3>Hello.</h3></div>#}
{#              <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.#}
{#                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis#}
{#                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.#}
{#                Aliquam in felis sit amet augue.#}
{#              </div>#}
{#            </div>#}
{##}
{#            <div class="panel panel-default" id="sec3">#}
{#              <div class="panel-heading"><h3>Hello.</h3></div>#}
{#              <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.#}
{#                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis#}
{#                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.#}
{#                Aliquam in felis sit amet augue.#}
{#              </div>#}
{#            </div>#}
{##}
{##}
{#            <div class="panel panel-default" id="sec3">#}
{#              <div class="panel-heading"><h3>Hello.</h3></div>#}
{#              <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.#}
{#                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis#}
{#                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.#}
{#                Aliquam in felis sit amet augue.#}
{#              </div>#}
{#            </div>#}
{##}
{##}
{#            <div class="panel panel-default" id="sec3">#}
{#              <div class="panel-heading"><h3>Hello.</h3></div>#}
{#              <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.#}
{#                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis#}
{#                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.#}
{#                Aliquam in felis sit amet augue.#}
{#              </div>#}
{#            </div>#}
{##}
{#                </div>#}

            </div>

            <div class="section-container" id="contact_det">
                <div class="section-header">
                    <h1>Pricing Details</h1>
                </div>
                <hr class="section-separator">
                <div class="row">

                    <div class="col-md-12">
                        {{ form.contact_name | bootstrap }}
                        </div>

                    <div class="col-md-12">
                        {{ form.contact_number | bootstrap }}
                        </div>

                    <div class="col-md-12">
                        {{ form.contact_email | bootstrap }}
                    </div>

                    <div class="col-md-12">
                        {{ form.contact_number2 | bootstrap }}
                        </div>
                </div>
                </div>


            <div class="section-container" id="contact_det">
                <div class="section-header">
                    <h1>Contact Details</h1>
                </div>
                <hr class="section-separator">
                <div class="row">

                    <div class="col-md-12">
                        {{ form.contact_name | bootstrap }}
                        </div>

                    <div class="col-md-12">
                        {{ form.contact_number | bootstrap }}
                        </div>

                    <div class="col-md-12">
                        {{ form.contact_email | bootstrap }}
                    </div>

                    <div class="col-md-12">
                        {{ form.contact_number2 | bootstrap }}
                        </div>
                </div>
                </div>

            </form>
        </div>



    
<div class= "row">
    <div class = " col-md-offset-2 col-md-8" >

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <h2>Basics</h2>


{% for field in form %}

    {% if field.name == 'tags' %}

        <h4>{{ form.tags.name }} : </h4>

            <ul>
                {% for choice in form.tags.field.choices %}
                    <li class="tagged talent-{{ choice.2.talent.pk }}" talent_for="{{ choice.2.talent.pk }}">
                        <input type="checkbox"
                               name="{{ form.tags.name }}"
                               value="{{ choice.0 }}"
                                {% if choice.0|safe in form.tags.value or choice.0 in form.tags.value %} checked="checked" {% endif %}>
                        <strong>{{ choice.2 }}</strong>
                    </li>
                {% endfor %}
            </ul>

            {% if form.tags.errors %}
                <span class="help-block">{{ form.tags.errors }}</span>
            {% endif %}

    {% else %}
        {{ field | bootstrap }}

    {% endif %}

{% endfor %}


  <h2>Projects</h2>

{% bootstrap_dynamic_formset formset can_order=True can_delete=True layout="horizontal" %}

    {{ formset.management_form |bootstrap}}

    {% for formi in formset %}
        <div class="project_formset project_form_{{ forloop.counter }}">
        <h4>Project {{ forloop.counter }}</h4>

        {% for field in formi %}
            {% if field.label != 'Listing' and field.label != 'Id' %}
                {{ field|bootstrap }}
                {{ field.errors }}
            {% endif %}
        <br/>
        {% endfor %}
        </div>
    {% endfor %}

    <button id="add_more_project">+1 Project</button>

    <input type="submit" id="form-submit" class = "btn btn-default" value="submit">

</form>
</div>
</div>
{% endblock %}